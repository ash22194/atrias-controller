function [D,C,G,B,DampingSpringTorque,B_HarmonicDrive]= LagrangeModelAtrias2D(q,dq)
%%%%%%  LagrangeModelAtrias2D.m
%%%%  24-May-2012 09:56:15
%%%%
%%%% Authors(s): Grizzle
%%%%
%%%%
%%%% Model NOTATION: Spong and Vidyasagar, page 142, Eq. (6.3.12)
%%%%                 D(q)ddq + C(q,dq)*dq + G(q) + DampingSpringTorque = B*tau
%%%%
%%%%
[g mTotal L1 L2 L3 L4 m1 m2 m3 m4 Jcm1 Jcm2 Jcm3 Jcm4 ellzcm1 ...
         ellzcm2 ellzcm3 ellzcm4 ellycm1 ellycm2 ellycm3 ellycm4 LT mT ...
         JcmT ellzcmT ellycmT mH JcmH K1 K2 Kd1 Kd2 Jrotor1 Jrotor2 ...
         Jgear1  Jgear2 R1  R2 Kfric_HarmonicDrive] = ...
         modelParametersAtrias_v05;
%%%%
%%%%[g mTotal L1 L2 L3 L4 m1 m2 m3 m4 Jcm1 Jcm2 Jcm3 Jcm4 ellzcm1 ellzcm2 ellzcm3 ellzcm4 ellycm1 ellycm2 ellycm3 ellycm4 LT mT JcmT ellzcmT ellycmT mH JcmH K1 K2 Kd1 Kd2 Jrotor1 Jrotor2 Jgear1  Jgear2 R1  R2 Kfric_HarmonicDrive] = modelParametersAtrias_v05;
%%%%
%%%%
qT=q(1);  dqT=dq(1);
q1=q(2);  dq1=dq(2);
q2=q(3);  dq2=dq(3);
qgr1=q(4);  dqgr1=dq(4);
qgr2=q(5);  dqgr2=dq(5);
q1L=q(6);  dq1L=dq(6);
q2L=q(7);  dq2L=dq(7);
qgr1L=q(8);  dqgr1L=dq(8);
qgr2L=q(9);  dqgr2L=dq(9);
%%%%
%%%%
D=zeros(9,9);
D(1,1)=2*mT*L4*ellycmT*sin(q1)-2*m3*L2*L1*...
         cos(-q2+q1)+JcmH+JcmT+2*m2*L2*ellycm2*sin(q2-q2L)+2*m4*L2*...
         ellzcm4*cos(q1L-q2L)-2*m1*L2*ellzcm1*cos(q2-q1L)+2*mH*L2*L4*...
         cos(-q2+q1)+2*Jcm1+2*m4*L2*ellycm4*sin(q1L-q2L)+2*m1*ellzcm1^2+2*...
         m3*ellycm3^2+2*m3*ellzcm3^2+2*m3*L2^2+2*m3*L4^2+mT*ellzcmT^2+mT*...
         L4^2+mH*L2^2+mH*L4^2+mT*ellycmT^2-2*m3*L1*ellycm3*sin(-q2+q1)-2*...
         m4*L2*ellzcm4*cos(q2-q1L)-2*m2*L4*ellzcm2*cos(q1-q2L)+4*m2*L2*L4*...
         cos(-q2+q1)+2*m1*L4*ellycm1*sin(q1-q1L)+2*m2*L4*ellycm2*...
         sin(q1-q2L)+2*Jrotor1+2*Jgear1-2*m1*L4*ellzcm1*cos(q1-q1L)+2*m3*...
         L4*ellycm3*sin(q1-q2L)-2*m3*L4*ellzcm3*cos(q1-q2L)-2*m4*L4*...
         ellzcm4*cos(q1-q1L)+2*m4*L4*ellycm4*sin(q1-q1L)-2*m2*L2*ellzcm2*...
         cos(q2-q2L)+2*m2*L2^2+2*m4*ellzcm4^2+2*m4*ellycm4^2+2*m2*L4^2+2*...
         m2*ellycm2^2+2*m1*L2^2+2*m1*ellycm1^2+2*m4*L4^2+2*m1*L4^2-2*m2*...
         L4*ellzcm2*cos(-q2+q1)+2*Jcm2+2*m3*L4*ellycm3*sin(-q2+q1)-2*m4*...
         L4*ellzcm4-2*m1*L2*ellycm1*sin(-q2+q1)+4*m1*L2*L4*cos(-q2+q1)+2*...
         m4*L2^2-2*m4*L2^2*cos(q2-q2L)+2*m2*L4*ellycm2*sin(-q2+q1)-2*m1*...
         L2*ellzcm1*cos(-q2+q1)+2*m3*L1^2+2*m4*L2*ellycm4*sin(q2-q1L)-2*...
         mT*L4*ellzcmT*cos(q1)-2*m3*L2*L1*cos(q2-q1L)+2*m3*L2*ellycm3*...
         sin(q2-q2L)-2*m3*L4*L1*cos(q1-q1L)-2*mT*L2*ellzcmT*cos(q2)+2*...
         Jcm4-2*m3*L2*ellzcm3-2*m3*L4*L1-2*m1*L4*ellzcm1-2*m2*L2*...
         ellzcm2+2*Jrotor2+2*Jgear2+2*Jcm3+2*mT*L2*ellycmT*sin(q2)-2*m3*...
         L1*ellycm3*sin(q1L-q2L)+2*m3*L1*ellzcm3*cos(q1L-q2L)+4*m3*L2*L4*...
         cos(-q2+q1)-2*m3*L4*ellzcm3*cos(-q2+q1)+2*m2*ellzcm2^2+mT*L2^2+2*...
         m1*L2*ellycm1*sin(q2-q1L)-2*m4*L2*L4*cos(q1-q2L)+2*m4*L2*L4*...
         cos(-q2+q1)+2*mT*L2*L4*cos(-q2+q1)-2*m3*L2*ellzcm3*cos(q2-q2L)+2*...
         m3*L1*ellzcm3*cos(-q2+q1);
D(1,2)=Jcm1+mH*L2*L4*cos(-q2+q1)-m1*L4*ellzcm1*cos(q1-q1L)+m1*...
         ellzcm1^2+2*m3*L4^2+mT*L4^2+mH*L4^2+m1*L4*ellycm1*sin(q1-q1L)+m3*...
         L4*ellycm3*sin(q1-q2L)+m4*ellzcm4^2+m4*ellycm4^2+2*m2*L4^2+m1*...
         ellycm1^2+2*m4*L4^2+2*m1*L4^2-m2*L4*ellzcm2*cos(-q2+q1)-m1*L2*...
         ellzcm1*cos(-q2+q1)-m3*L4*ellzcm3*cos(-q2+q1)+m2*L4*ellycm2*...
         sin(-q2+q1)+mT*L4*ellycmT*sin(q1)-2*m4*L4*ellzcm4-mT*L4*ellzcmT*...
         cos(q1)-m1*L2*ellycm1*sin(-q2+q1)+2*m3*L2*L4*cos(-q2+q1)+m3*...
         L1^2-m3*L4*ellzcm3*cos(q1-q2L)+m4*L2*L4*cos(-q2+q1)+m3*L4*...
         ellycm3*sin(-q2+q1)+mT*L2*L4*cos(-q2+q1)-m3*L2*L1*cos(-q2+q1)-m3*...
         L1*ellycm3*sin(-q2+q1)+2*m1*L2*L4*cos(-q2+q1)+Jcm4-2*m3*L4*L1-2*...
         m1*L4*ellzcm1-m3*L4*L1*cos(q1-q1L)+2*m2*L2*L4*cos(-q2+q1)-m2*L4*...
         ellzcm2*cos(q1-q2L)-m4*L4*ellzcm4*cos(q1-q1L)+m4*L4*ellycm4*...
         sin(q1-q1L)-m4*L2*L4*cos(q1-q2L)+m2*L4*ellycm2*sin(q1-q2L)+m3*L1*...
         ellzcm3*cos(-q2+q1);
D(1,3)=-m1*L2*ellzcm1*cos(-q2+q1)+m3*L4*ellycm3*sin(-q2+q1)+m4*...
         L2*L4*cos(-q2+q1)+m1*L2*ellycm1*sin(q2-q1L)-m3*L2*L1*...
         cos(-q2+q1)+mH*L2*L4*cos(-q2+q1)-m3*L2*L1*cos(q2-q1L)-m4*L2^2*...
         cos(q2-q2L)-m4*L2*ellzcm4*cos(q2-q1L)-m1*L2*ellzcm1*...
         cos(q2-q1L)+2*m3*L2*L4*cos(-q2+q1)+mT*L2*L4*cos(-q2+q1)-m2*L4*...
         ellzcm2*cos(-q2+q1)+2*m2*L2*L4*cos(-q2+q1)+m2*L4*ellycm2*...
         sin(-q2+q1)+m4*L2^2-2*m2*L2*ellzcm2-m3*L4*ellzcm3*...
         cos(-q2+q1)+Jcm3+m2*ellzcm2^2+mT*L2^2-2*m3*L2*ellzcm3+2*m1*L2*L4*...
         cos(-q2+q1)-m2*L2*ellzcm2*cos(q2-q2L)+2*m3*L2^2+2*m2*L2^2+2*m1*...
         L2^2+m3*L1*ellzcm3*cos(-q2+q1)-m1*L2*ellycm1*sin(-q2+q1)-m3*L1*...
         ellycm3*sin(-q2+q1)+m3*ellycm3^2+m3*ellzcm3^2+mH*L2^2+m2*...
         ellycm2^2+Jcm2+mT*L2*ellycmT*sin(q2)+m2*L2*ellycm2*...
         sin(q2-q2L)-m3*L2*ellzcm3*cos(q2-q2L)+m3*L2*ellycm3*...
         sin(q2-q2L)-mT*L2*ellzcmT*cos(q2)+m4*L2*ellycm4*sin(q2-q1L);
D(1,4)=Jgear1+Jrotor1*R1;
D(1,5)=Jgear2+Jrotor2*R2;
D(1,6)=m4*L2*ellycm4*sin(q2-q1L)+m1*L2*ellycm1*sin(q2-q1L)-m3*L2*...
         L1*cos(q2-q1L)-m4*L2*ellzcm4*cos(q2-q1L)-m1*L2*ellzcm1*...
         cos(q2-q1L)-m3*L1*ellycm3*sin(q1L-q2L)-m3*L4*L1*cos(q1-q1L)-m1*...
         L4*ellzcm1*cos(q1-q1L)-m4*L4*ellzcm4*cos(q1-q1L)+m3*L1*ellzcm3*...
         cos(q1L-q2L)+m4*L2*ellzcm4*cos(q1L-q2L)+m4*L4*ellycm4*...
         sin(q1-q1L)+m4*L2*ellycm4*sin(q1L-q2L)+m1*L4*ellycm1*...
         sin(q1-q1L)+Jcm1+m1*ellzcm1^2+m4*ellzcm4^2+m4*ellycm4^2+m1*...
         ellycm1^2+m3*L1^2+Jcm4;
D(1,7)=m3*ellycm3^2+m3*ellzcm3^2+m2*L2*ellycm2*sin(q2-q2L)-m3*L1*...
         ellycm3*sin(q1L-q2L)+Jcm2+m4*L2^2+Jcm3-m2*L2*ellzcm2*...
         cos(q2-q2L)-m2*L4*ellzcm2*cos(q1-q2L)+m2*L4*ellycm2*...
         sin(q1-q2L)+m2*ellycm2^2+m3*L4*ellycm3*sin(q1-q2L)-m3*L4*ellzcm3*...
         cos(q1-q2L)+m3*L1*ellzcm3*cos(q1L-q2L)-m3*L2*ellzcm3*...
         cos(q2-q2L)-m4*L4*L2*cos(q1-q2L)+m3*L2*ellycm3*sin(q2-q2L)+m4*L2*...
         ellzcm4*cos(q1L-q2L)+m2*ellzcm2^2+m4*L2*ellycm4*sin(q1L-q2L)-m4*...
         L2^2*cos(q2-q2L);
D(1,8)=Jgear1+Jrotor1*R1;
D(1,9)=Jgear2+Jrotor2*R2;
D(2,1)=Jcm1+mH*L2*L4*cos(-q2+q1)-m1*L4*ellzcm1*cos(q1-q1L)+m1*...
         ellzcm1^2+2*m3*L4^2+mT*L4^2+mH*L4^2+m1*L4*ellycm1*sin(q1-q1L)+m3*...
         L4*ellycm3*sin(q1-q2L)+m4*ellzcm4^2+m4*ellycm4^2+2*m2*L4^2+m1*...
         ellycm1^2+2*m4*L4^2+2*m1*L4^2-m2*L4*ellzcm2*cos(-q2+q1)-m1*L2*...
         ellzcm1*cos(-q2+q1)-m3*L4*ellzcm3*cos(-q2+q1)+m2*L4*ellycm2*...
         sin(-q2+q1)+mT*L4*ellycmT*sin(q1)-2*m4*L4*ellzcm4-mT*L4*ellzcmT*...
         cos(q1)-m1*L2*ellycm1*sin(-q2+q1)+2*m3*L2*L4*cos(-q2+q1)+m3*...
         L1^2-m3*L4*ellzcm3*cos(q1-q2L)+m4*L2*L4*cos(-q2+q1)+m3*L4*...
         ellycm3*sin(-q2+q1)+mT*L2*L4*cos(-q2+q1)-m3*L2*L1*cos(-q2+q1)-m3*...
         L1*ellycm3*sin(-q2+q1)+2*m1*L2*L4*cos(-q2+q1)+Jcm4-2*m3*L4*L1-2*...
         m1*L4*ellzcm1-m3*L4*L1*cos(q1-q1L)+2*m2*L2*L4*cos(-q2+q1)-m2*L4*...
         ellzcm2*cos(q1-q2L)-m4*L4*ellzcm4*cos(q1-q1L)+m4*L4*ellycm4*...
         sin(q1-q1L)-m4*L2*L4*cos(q1-q2L)+m2*L4*ellycm2*sin(q1-q2L)+m3*L1*...
         ellzcm3*cos(-q2+q1);
D(2,2)=(ellzcm1^2+ellycm1^2-2*L4*ellzcm1+2*L4^2)*m1-2*m4*L4*...
         ellzcm4+2*m3*L4^2+m3*L1^2+2*m4*L4^2+m4*ellzcm4^2+2*m2*L4^2+mH*...
         L4^2+mT*L4^2+m4*ellycm4^2-2*m3*L4*L1+Jcm1+Jcm4;
D(2,3)=2*m2*L2*L4*cos(-q2+q1)+2*m3*L2*L4*cos(-q2+q1)+mH*L2*L4*...
         cos(-q2+q1)+m4*L4*L2*cos(-q2+q1)+mT*L2*L4*cos(-q2+q1)-m1*L2*...
         ellzcm1*cos(-q2+q1)-m2*L4*ellzcm2*cos(-q2+q1)+m2*L4*ellycm2*...
         sin(-q2+q1)-m1*L2*ellycm1*sin(-q2+q1)-m3*L2*L1*cos(-q2+q1)-m3*L1*...
         ellycm3*sin(-q2+q1)+2*m1*L2*L4*cos(-q2+q1)+m3*L1*ellzcm3*...
         cos(-q2+q1)+m3*L4*ellycm3*sin(-q2+q1)-m3*L4*ellzcm3*cos(-q2+q1);
D(2,6)=-m3*L4*L1*cos(q1-q1L)-m1*L4*ellzcm1*cos(q1-q1L)+m1*L4*...
         ellycm1*sin(q1-q1L)+m4*L4*ellycm4*sin(q1-q1L)-m4*L4*ellzcm4*...
         cos(q1-q1L);
D(2,7)=-m3*L4*ellzcm3*cos(q1-q2L)+m3*L4*ellycm3*sin(q1-q2L)-m4*...
         L4*L2*cos(q1-q2L)-m2*L4*ellzcm2*cos(q1-q2L)+m2*L4*ellycm2*...
         sin(q1-q2L);
D(3,1)=-m1*L2*ellzcm1*cos(-q2+q1)+m3*L4*ellycm3*sin(-q2+q1)+m4*...
         L2*L4*cos(-q2+q1)+m1*L2*ellycm1*sin(q2-q1L)-m3*L2*L1*...
         cos(-q2+q1)+mH*L2*L4*cos(-q2+q1)-m3*L2*L1*cos(q2-q1L)-m4*L2^2*...
         cos(q2-q2L)-m4*L2*ellzcm4*cos(q2-q1L)-m1*L2*ellzcm1*...
         cos(q2-q1L)+2*m3*L2*L4*cos(-q2+q1)+mT*L2*L4*cos(-q2+q1)-m2*L4*...
         ellzcm2*cos(-q2+q1)+2*m2*L2*L4*cos(-q2+q1)+m2*L4*ellycm2*...
         sin(-q2+q1)+m4*L2^2-2*m2*L2*ellzcm2-m3*L4*ellzcm3*...
         cos(-q2+q1)+Jcm3+m2*ellzcm2^2+mT*L2^2-2*m3*L2*ellzcm3+2*m1*L2*L4*...
         cos(-q2+q1)-m2*L2*ellzcm2*cos(q2-q2L)+2*m3*L2^2+2*m2*L2^2+2*m1*...
         L2^2+m3*L1*ellzcm3*cos(-q2+q1)-m1*L2*ellycm1*sin(-q2+q1)-m3*L1*...
         ellycm3*sin(-q2+q1)+m3*ellycm3^2+m3*ellzcm3^2+mH*L2^2+m2*...
         ellycm2^2+Jcm2+mT*L2*ellycmT*sin(q2)+m2*L2*ellycm2*...
         sin(q2-q2L)-m3*L2*ellzcm3*cos(q2-q2L)+m3*L2*ellycm3*...
         sin(q2-q2L)-mT*L2*ellzcmT*cos(q2)+m4*L2*ellycm4*sin(q2-q1L);
D(3,2)=2*m2*L2*L4*cos(-q2+q1)+2*m3*L2*L4*cos(-q2+q1)+mH*L2*L4*...
         cos(-q2+q1)+m4*L4*L2*cos(-q2+q1)+mT*L2*L4*cos(-q2+q1)-m1*L2*...
         ellzcm1*cos(-q2+q1)-m2*L4*ellzcm2*cos(-q2+q1)+m2*L4*ellycm2*...
         sin(-q2+q1)-m1*L2*ellycm1*sin(-q2+q1)-m3*L2*L1*cos(-q2+q1)-m3*L1*...
         ellycm3*sin(-q2+q1)+2*m1*L2*L4*cos(-q2+q1)+m3*L1*ellzcm3*...
         cos(-q2+q1)+m3*L4*ellycm3*sin(-q2+q1)-m3*L4*ellzcm3*cos(-q2+q1);
D(3,3)=2*m3*L2^2+m4*L2^2+2*m2*L2^2+m3*ellycm3^2+m3*ellzcm3^2+2*...
         m1*L2^2+m2*ellzcm2^2-2*m3*L2*ellzcm3+Jcm3+m2*ellycm2^2-2*m2*L2*...
         ellzcm2+Jcm2+mT*L2^2+mH*L2^2;
D(3,6)=-m3*L2*L1*cos(q2-q1L)-m4*L2*ellzcm4*cos(q2-q1L)+m4*L2*...
         ellycm4*sin(q2-q1L)-m1*L2*ellzcm1*cos(q2-q1L)+m1*L2*ellycm1*...
         sin(q2-q1L);
D(3,7)=-m3*L2*ellzcm3*cos(q2-q2L)+m3*L2*ellycm3*sin(q2-q2L)-m4*...
         L2^2*cos(q2-q2L)-m2*L2*ellzcm2*cos(q2-q2L)+m2*L2*ellycm2*...
         sin(q2-q2L);
D(4,1)=Jgear1+Jrotor1*R1;
D(4,4)=Jgear1+Jrotor1*R1^2;
D(5,1)=Jgear2+Jrotor2*R2;
D(5,5)=Jgear2+Jrotor2*R2^2;
D(6,1)=m4*L2*ellycm4*sin(q2-q1L)+m1*L2*ellycm1*sin(q2-q1L)-m3*L2*...
         L1*cos(q2-q1L)-m4*L2*ellzcm4*cos(q2-q1L)-m1*L2*ellzcm1*...
         cos(q2-q1L)-m3*L1*ellycm3*sin(q1L-q2L)-m3*L4*L1*cos(q1-q1L)-m1*...
         L4*ellzcm1*cos(q1-q1L)-m4*L4*ellzcm4*cos(q1-q1L)+m3*L1*ellzcm3*...
         cos(q1L-q2L)+m4*L2*ellzcm4*cos(q1L-q2L)+m4*L4*ellycm4*...
         sin(q1-q1L)+m4*L2*ellycm4*sin(q1L-q2L)+m1*L4*ellycm1*...
         sin(q1-q1L)+Jcm1+m1*ellzcm1^2+m4*ellzcm4^2+m4*ellycm4^2+m1*...
         ellycm1^2+m3*L1^2+Jcm4;
D(6,2)=-m3*L4*L1*cos(q1-q1L)-m1*L4*ellzcm1*cos(q1-q1L)+m1*L4*...
         ellycm1*sin(q1-q1L)+m4*L4*ellycm4*sin(q1-q1L)-m4*L4*ellzcm4*...
         cos(q1-q1L);
D(6,3)=-m3*L2*L1*cos(q2-q1L)-m4*L2*ellzcm4*cos(q2-q1L)+m4*L2*...
         ellycm4*sin(q2-q1L)-m1*L2*ellzcm1*cos(q2-q1L)+m1*L2*ellycm1*...
         sin(q2-q1L);
D(6,6)=(ellzcm1^2+ellycm1^2)*m1+m4*ellzcm4^2+Jcm4+m3*L1^2+m4*...
         ellycm4^2+Jcm1;
D(6,7)=m3*L1*ellzcm3*cos(q1L-q2L)-m3*L1*ellycm3*sin(q1L-q2L)+m4*...
         L2*ellzcm4*cos(q1L-q2L)+m4*L2*ellycm4*sin(q1L-q2L);
D(7,1)=m3*ellycm3^2+m3*ellzcm3^2+m2*L2*ellycm2*sin(q2-q2L)-m3*L1*...
         ellycm3*sin(q1L-q2L)+Jcm2+m4*L2^2+Jcm3-m2*L2*ellzcm2*...
         cos(q2-q2L)-m2*L4*ellzcm2*cos(q1-q2L)+m2*L4*ellycm2*...
         sin(q1-q2L)+m2*ellycm2^2+m3*L4*ellycm3*sin(q1-q2L)-m3*L4*ellzcm3*...
         cos(q1-q2L)+m3*L1*ellzcm3*cos(q1L-q2L)-m3*L2*ellzcm3*...
         cos(q2-q2L)-m4*L4*L2*cos(q1-q2L)+m3*L2*ellycm3*sin(q2-q2L)+m4*L2*...
         ellzcm4*cos(q1L-q2L)+m2*ellzcm2^2+m4*L2*ellycm4*sin(q1L-q2L)-m4*...
         L2^2*cos(q2-q2L);
D(7,2)=-m3*L4*ellzcm3*cos(q1-q2L)+m3*L4*ellycm3*sin(q1-q2L)-m4*...
         L4*L2*cos(q1-q2L)-m2*L4*ellzcm2*cos(q1-q2L)+m2*L4*ellycm2*...
         sin(q1-q2L);
D(7,3)=-m3*L2*ellzcm3*cos(q2-q2L)+m3*L2*ellycm3*sin(q2-q2L)-m4*...
         L2^2*cos(q2-q2L)-m2*L2*ellzcm2*cos(q2-q2L)+m2*L2*ellycm2*...
         sin(q2-q2L);
D(7,6)=m3*L1*ellzcm3*cos(q1L-q2L)-m3*L1*ellycm3*sin(q1L-q2L)+m4*...
         L2*ellzcm4*cos(q1L-q2L)+m4*L2*ellycm4*sin(q1L-q2L);
D(7,7)=(ellzcm2^2+ellycm2^2)*m2+m3*ellzcm3^2+m3*ellycm3^2+m4*...
         L2^2+Jcm2+Jcm3;
D(8,1)=Jgear1+Jrotor1*R1;
D(8,8)=Jgear1+Jrotor1*R1^2;
D(9,1)=Jgear2+Jrotor2*R2;
D(9,9)=Jgear2+Jrotor2*R2^2;
%%%%
%%%%
%%%%
%%%%
C=zeros(9,9);
C(1,1)=(mT*L4*ellycmT*cos(q1)+m3*L2*L1*sin(-q2+q1)-mH*L2*L4*...
         sin(-q2+q1)-m3*L1*ellycm3*cos(-q2+q1)+m2*L4*ellzcm2*...
         sin(q1-q2L)-2*m2*L2*L4*sin(-q2+q1)+m1*L4*ellycm1*cos(q1-q1L)+m2*...
         L4*ellycm2*cos(q1-q2L)+m1*L4*ellzcm1*sin(q1-q1L)+m3*L4*ellycm3*...
         cos(q1-q2L)+m3*L4*ellzcm3*sin(q1-q2L)+m4*L4*ellzcm4*...
         sin(q1-q1L)+m4*L4*ellycm4*cos(q1-q1L)+m2*L4*ellzcm2*...
         sin(-q2+q1)+m3*L4*ellycm3*cos(-q2+q1)-m1*L2*ellycm1*...
         cos(-q2+q1)-2*m1*L2*L4*sin(-q2+q1)+m2*L4*ellycm2*cos(-q2+q1)+m1*...
         L2*ellzcm1*sin(-q2+q1)+mT*L4*ellzcmT*sin(q1)+m3*L4*L1*...
         sin(q1-q1L)-2*m3*L2*L4*sin(-q2+q1)+m3*L4*ellzcm3*sin(-q2+q1)+m4*...
         L2*L4*sin(q1-q2L)-m4*L2*L4*sin(-q2+q1)-mT*L2*L4*sin(-q2+q1)-m3*...
         L1*ellzcm3*sin(-q2+q1))*dq1+(m4*L2^2*sin(q2-q2L)-m3*L2*L1*...
         sin(-q2+q1)+m4*L2*ellzcm4*sin(q2-q1L)+mH*L2*L4*sin(-q2+q1)+m3*L1*...
         ellycm3*cos(-q2+q1)+2*m2*L2*L4*sin(-q2+q1)+m1*L2*ellycm1*...
         cos(q2-q1L)+m4*L2*ellycm4*cos(q2-q1L)+m3*L2*L1*sin(q2-q1L)+mT*L2*...
         ellzcmT*sin(q2)+mT*L2*ellycmT*cos(q2)-m2*L4*ellzcm2*...
         sin(-q2+q1)-m3*L4*ellycm3*cos(-q2+q1)+m1*L2*ellycm1*...
         cos(-q2+q1)+2*m1*L2*L4*sin(-q2+q1)-m2*L4*ellycm2*cos(-q2+q1)-m1*...
         L2*ellzcm1*sin(-q2+q1)+2*m3*L2*L4*sin(-q2+q1)-m3*L4*ellzcm3*...
         sin(-q2+q1)+m4*L2*L4*sin(-q2+q1)+mT*L2*L4*sin(-q2+q1)+m3*L1*...
         ellzcm3*sin(-q2+q1)+m3*L2*ellzcm3*sin(q2-q2L)+m3*L2*ellycm3*...
         cos(q2-q2L)+m2*L2*ellzcm2*sin(q2-q2L)+m2*L2*ellycm2*...
         cos(q2-q2L)+m1*L2*ellzcm1*sin(q2-q1L))*dq2+(-m3*L1*ellzcm3*...
         sin(q1L-q2L)-m1*L2*ellzcm1*sin(q2-q1L)-m4*L2*ellzcm4*...
         sin(q2-q1L)-m1*L4*ellycm1*cos(q1-q1L)-m1*L4*ellzcm1*...
         sin(q1-q1L)-m4*L4*ellzcm4*sin(q1-q1L)-m4*L4*ellycm4*...
         cos(q1-q1L)-m4*L2*ellycm4*cos(q2-q1L)-m3*L2*L1*sin(q2-q1L)-m3*L4*...
         L1*sin(q1-q1L)-m1*L2*ellycm1*cos(q2-q1L)+m4*L2*ellycm4*...
         cos(q1L-q2L)-m3*L1*ellycm3*cos(q1L-q2L)-m4*L2*ellzcm4*...
         sin(q1L-q2L))*dq1L+(-m4*L2^2*sin(q2-q2L)-m3*L2*ellzcm3*...
         sin(q2-q2L)+m3*L1*ellzcm3*sin(q1L-q2L)-m2*L2*ellzcm2*...
         sin(q2-q2L)-m2*L2*ellycm2*cos(q2-q2L)-m2*L4*ellzcm2*...
         sin(q1-q2L)-m2*L4*ellycm2*cos(q1-q2L)-m3*L4*ellycm3*...
         cos(q1-q2L)-m3*L4*ellzcm3*sin(q1-q2L)-m4*L2*L4*sin(q1-q2L)-m4*L2*...
         ellycm4*cos(q1L-q2L)-m3*L2*ellycm3*cos(q2-q2L)+m3*L1*ellycm3*...
         cos(q1L-q2L)+m4*L2*ellzcm4*sin(q1L-q2L))*dq2L;
C(1,2)=(m3*L4*ellycm3*cos(q1-q2L)+m2*L4*ellycm2*cos(q1-q2L)+m2*...
         L4*ellzcm2*sin(q1-q2L)-2*m2*L2*L4*sin(-q2+q1)-2*m1*L2*L4*...
         sin(-q2+q1)-2*m3*L2*L4*sin(-q2+q1)+mT*L4*ellycmT*cos(q1)+m3*L2*...
         L1*sin(-q2+q1)-mH*L2*L4*sin(-q2+q1)-m3*L1*ellycm3*cos(-q2+q1)+m2*...
         L4*ellzcm2*sin(-q2+q1)+m3*L4*ellycm3*cos(-q2+q1)-m1*L2*ellycm1*...
         cos(-q2+q1)+m2*L4*ellycm2*cos(-q2+q1)+m1*L2*ellzcm1*...
         sin(-q2+q1)+mT*L4*ellzcmT*sin(q1)+m3*L4*ellzcm3*sin(-q2+q1)-m4*...
         L2*L4*sin(-q2+q1)-mT*L2*L4*sin(-q2+q1)-m3*L1*ellzcm3*...
         sin(-q2+q1)+m1*L4*ellycm1*cos(q1-q1L)+m1*L4*ellzcm1*...
         sin(q1-q1L)+m4*L4*L2*sin(q1-q2L)+m3*L4*L1*sin(q1-q1L)+m4*L4*...
         ellycm4*cos(q1-q1L)+m4*L4*ellzcm4*sin(q1-q1L)+m3*L4*ellzcm3*...
         sin(q1-q2L))*(dqT+dq1);
C(1,3)=(dqT+dq2)*(m4*L2*ellzcm4*sin(q2-q1L)+m1*L2*ellycm1*...
         cos(q2-q1L)+m4*L2*ellycm4*cos(q2-q1L)+m3*L2*L1*sin(q2-q1L)+mT*L2*...
         ellzcmT*sin(q2)+mT*L2*ellycmT*cos(q2)+m3*L2*ellzcm3*...
         sin(q2-q2L)+m3*L2*ellycm3*cos(q2-q2L)+m2*L2*ellzcm2*...
         sin(q2-q2L)+m2*L2*ellycm2*cos(q2-q2L)+m1*L2*ellzcm1*...
         sin(q2-q1L)+2*m2*L2*L4*sin(-q2+q1)+2*m1*L2*L4*sin(-q2+q1)+2*m3*...
         L2*L4*sin(-q2+q1)-m3*L2*L1*sin(-q2+q1)+mH*L2*L4*sin(-q2+q1)+m3*...
         L1*ellycm3*cos(-q2+q1)-m2*L4*ellzcm2*sin(-q2+q1)-m3*L4*ellycm3*...
         cos(-q2+q1)+m1*L2*ellycm1*cos(-q2+q1)-m2*L4*ellycm2*...
         cos(-q2+q1)-m1*L2*ellzcm1*sin(-q2+q1)-m3*L4*ellzcm3*...
         sin(-q2+q1)+m4*L2*L4*sin(-q2+q1)+mT*L2*L4*sin(-q2+q1)+m3*L1*...
         ellzcm3*sin(-q2+q1)+m4*L2^2*sin(q2-q2L));
C(1,6)=-(m3*L1*ellzcm3*sin(q1L-q2L)+m4*L2*ellzcm4*...
         sin(q1L-q2L)-m4*L2*ellycm4*cos(q1L-q2L)+m3*L1*ellycm3*...
         cos(q1L-q2L)+m1*L4*ellycm1*cos(q1-q1L)+m1*L4*ellzcm1*...
         sin(q1-q1L)+m1*L2*ellycm1*cos(q2-q1L)+m3*L2*L1*sin(q2-q1L)+m4*L2*...
         ellzcm4*sin(q2-q1L)+m1*L2*ellzcm1*sin(q2-q1L)+m3*L4*L1*...
         sin(q1-q1L)+m4*L4*ellycm4*cos(q1-q1L)+m4*L4*ellzcm4*...
         sin(q1-q1L)+m4*L2*ellycm4*cos(q2-q1L))*(dqT+dq1L);
C(1,7)=(-m4*L2^2*sin(q2-q2L)+m3*L1*ellzcm3*sin(q1L-q2L)+m4*L2*...
         ellzcm4*sin(q1L-q2L)-m4*L2*ellycm4*cos(q1L-q2L)+m3*L1*ellycm3*...
         cos(q1L-q2L)-m3*L4*ellycm3*cos(q1-q2L)-m3*L4*ellzcm3*...
         sin(q1-q2L)-m2*L4*ellzcm2*sin(q1-q2L)-m2*L4*ellycm2*...
         cos(q1-q2L)-m4*L2*L4*sin(q1-q2L)-m2*L2*ellzcm2*sin(q2-q2L)-m2*L2*...
         ellycm2*cos(q2-q2L)-m3*L2*ellzcm3*sin(q2-q2L)-m3*L2*ellycm3*...
         cos(q2-q2L))*(dqT+dq2L);
C(2,1)=(-m3*L4*ellycm3*cos(q1-q2L)-m3*L2*L1*sin(-q2+q1)-m3*L4*...
         ellzcm3*sin(q1-q2L)+mH*L2*L4*sin(-q2+q1)+m3*L1*ellycm3*...
         cos(-q2+q1)+2*m2*L2*L4*sin(-q2+q1)-m2*L4*ellzcm2*sin(q1-q2L)-m2*...
         L4*ellycm2*cos(q1-q2L)-m2*L4*ellzcm2*sin(-q2+q1)-m3*L4*ellycm3*...
         cos(-q2+q1)+m1*L2*ellycm1*cos(-q2+q1)+2*m1*L2*L4*sin(-q2+q1)-m2*...
         L4*ellycm2*cos(-q2+q1)-m1*L2*ellzcm1*sin(-q2+q1)-m4*L2*L4*...
         sin(q1-q2L)+2*m3*L2*L4*sin(-q2+q1)-m3*L4*ellzcm3*sin(-q2+q1)+m4*...
         L2*L4*sin(-q2+q1)+mT*L2*L4*sin(-q2+q1)+m3*L1*ellzcm3*...
         sin(-q2+q1)-m1*L4*ellycm1*cos(q1-q1L)-m1*L4*ellzcm1*...
         sin(q1-q1L)-m3*L4*L1*sin(q1-q1L)-m4*L4*ellycm4*cos(q1-q1L)-m4*L4*...
         ellzcm4*sin(q1-q1L)-mT*L4*ellycmT*cos(q1)-mT*L4*ellzcmT*sin(q1))*...
         dqT+(-m1*L2*ellzcm1*sin(-q2+q1)-m3*L4*ellycm3*cos(-q2+q1)+m4*L2*...
         L4*sin(-q2+q1)+mH*L2*L4*sin(-q2+q1)-m3*L2*L1*sin(-q2+q1)+mT*L2*...
         L4*sin(-q2+q1)-m2*L4*ellzcm2*sin(-q2+q1)-m2*L4*ellycm2*...
         cos(-q2+q1)+m3*L1*ellycm3*cos(-q2+q1)+m1*L2*ellycm1*...
         cos(-q2+q1)+m3*L1*ellzcm3*sin(-q2+q1)-m3*L4*ellzcm3*...
         sin(-q2+q1)+2*m1*L2*L4*sin(-q2+q1)+2*m2*L2*L4*sin(-q2+q1)+2*m3*...
         L2*L4*sin(-q2+q1))*dq2+(-m1*L4*ellycm1*cos(q1-q1L)-m1*L4*ellzcm1*...
         sin(q1-q1L)-m3*L4*L1*sin(q1-q1L)-m4*L4*ellycm4*cos(q1-q1L)-m4*L4*...
         ellzcm4*sin(q1-q1L))*dq1L+(-m3*L4*ellycm3*cos(q1-q2L)-m3*L4*...
         ellzcm3*sin(q1-q2L)-m2*L4*ellzcm2*sin(q1-q2L)-m2*L4*ellycm2*...
         cos(q1-q2L)-m4*L2*L4*sin(q1-q2L))*dq2L;
C(2,3)=(-m1*L2*ellzcm1*sin(-q2+q1)-m3*L4*ellycm3*cos(-q2+q1)+m4*...
         L2*L4*sin(-q2+q1)+mH*L2*L4*sin(-q2+q1)-m3*L2*L1*sin(-q2+q1)+mT*...
         L2*L4*sin(-q2+q1)-m2*L4*ellzcm2*sin(-q2+q1)-m2*L4*ellycm2*...
         cos(-q2+q1)+m3*L1*ellycm3*cos(-q2+q1)+m1*L2*ellycm1*...
         cos(-q2+q1)+m3*L1*ellzcm3*sin(-q2+q1)-m3*L4*ellzcm3*...
         sin(-q2+q1)+2*m1*L2*L4*sin(-q2+q1)+2*m2*L2*L4*sin(-q2+q1)+2*m3*...
         L2*L4*sin(-q2+q1))*(dq2+dqT);
C(2,6)=-L4*(m1*ellycm1*cos(q1-q1L)+m1*ellzcm1*sin(q1-q1L)+m3*L1*...
         sin(q1-q1L)+m4*ellycm4*cos(q1-q1L)+m4*ellzcm4*sin(q1-q1L))*...
         (dqT+dq1L);
C(2,7)=-L4*(m3*ellycm3*cos(q1-q2L)+m3*ellzcm3*sin(q1-q2L)+m2*...
         ellzcm2*sin(q1-q2L)+m2*ellycm2*cos(q1-q2L)+m4*L2*sin(q1-q2L))*...
         (dqT+dq2L);
C(3,1)=(-m4*L2^2*sin(q2-q2L)+m3*L2*L1*sin(-q2+q1)-m4*L2*ellzcm4*...
         sin(q2-q1L)-mH*L2*L4*sin(-q2+q1)-m3*L1*ellycm3*cos(-q2+q1)-2*m2*...
         L2*L4*sin(-q2+q1)-m1*L2*ellycm1*cos(q2-q1L)-m4*L2*ellycm4*...
         cos(q2-q1L)-m3*L2*L1*sin(q2-q1L)-mT*L2*ellzcmT*sin(q2)-mT*L2*...
         ellycmT*cos(q2)+m2*L4*ellzcm2*sin(-q2+q1)+m3*L4*ellycm3*...
         cos(-q2+q1)-m1*L2*ellycm1*cos(-q2+q1)-2*m1*L2*L4*sin(-q2+q1)+m2*...
         L4*ellycm2*cos(-q2+q1)+m1*L2*ellzcm1*sin(-q2+q1)-2*m3*L2*L4*...
         sin(-q2+q1)+m3*L4*ellzcm3*sin(-q2+q1)-m4*L2*L4*sin(-q2+q1)-mT*L2*...
         L4*sin(-q2+q1)-m3*L1*ellzcm3*sin(-q2+q1)-m3*L2*ellzcm3*...
         sin(q2-q2L)-m3*L2*ellycm3*cos(q2-q2L)-m2*L2*ellzcm2*...
         sin(q2-q2L)-m2*L2*ellycm2*cos(q2-q2L)-m1*L2*ellzcm1*sin(q2-q1L))*...
         dqT+(m1*L2*ellzcm1*sin(-q2+q1)+m3*L4*ellycm3*cos(-q2+q1)-m4*L2*...
         L4*sin(-q2+q1)-mH*L2*L4*sin(-q2+q1)+m3*L2*L1*sin(-q2+q1)-mT*L2*...
         L4*sin(-q2+q1)+m2*L4*ellzcm2*sin(-q2+q1)+m2*L4*ellycm2*...
         cos(-q2+q1)-m3*L1*ellycm3*cos(-q2+q1)-m1*L2*ellycm1*...
         cos(-q2+q1)-m3*L1*ellzcm3*sin(-q2+q1)+m3*L4*ellzcm3*...
         sin(-q2+q1)-2*m1*L2*L4*sin(-q2+q1)-2*m2*L2*L4*sin(-q2+q1)-2*m3*...
         L2*L4*sin(-q2+q1))*dq1+(-m1*L2*ellycm1*cos(q2-q1L)-m3*L2*L1*...
         sin(q2-q1L)-m4*L2*ellzcm4*sin(q2-q1L)-m1*L2*ellzcm1*...
         sin(q2-q1L)-m4*L2*ellycm4*cos(q2-q1L))*dq1L+(-m4*L2^2*...
         sin(q2-q2L)-m2*L2*ellzcm2*sin(q2-q2L)-m2*L2*ellycm2*...
         cos(q2-q2L)-m3*L2*ellzcm3*sin(q2-q2L)-m3*L2*ellycm3*cos(q2-q2L))*...
         dq2L;
C(3,2)=-(-m1*L2*ellzcm1*sin(-q2+q1)-m3*L4*ellycm3*cos(-q2+q1)+m4*...
         L2*L4*sin(-q2+q1)+mH*L2*L4*sin(-q2+q1)-m3*L2*L1*sin(-q2+q1)+mT*...
         L2*L4*sin(-q2+q1)-m2*L4*ellzcm2*sin(-q2+q1)-m2*L4*ellycm2*...
         cos(-q2+q1)+m3*L1*ellycm3*cos(-q2+q1)+m1*L2*ellycm1*...
         cos(-q2+q1)+m3*L1*ellzcm3*sin(-q2+q1)-m3*L4*ellzcm3*...
         sin(-q2+q1)+2*m1*L2*L4*sin(-q2+q1)+2*m2*L2*L4*sin(-q2+q1)+2*m3*...
         L2*L4*sin(-q2+q1))*(dqT+dq1);
C(3,6)=-L2*(m1*ellycm1*cos(q2-q1L)+m3*L1*sin(q2-q1L)+m4*ellzcm4*...
         sin(q2-q1L)+m1*ellzcm1*sin(q2-q1L)+m4*ellycm4*cos(q2-q1L))*...
         (dqT+dq1L);
C(3,7)=-L2*(m4*L2*sin(q2-q2L)+m2*ellzcm2*sin(q2-q2L)+m2*ellycm2*...
         cos(q2-q2L)+m3*ellzcm3*sin(q2-q2L)+m3*ellycm3*cos(q2-q2L))*...
         (dqT+dq2L);
C(6,1)=(m3*L1*ellzcm3*sin(q1L-q2L)+m4*L2*ellzcm4*sin(q1L-q2L)-m4*...
         L2*ellycm4*cos(q1L-q2L)+m3*L1*ellycm3*cos(q1L-q2L)+m1*L4*ellycm1*...
         cos(q1-q1L)+m1*L4*ellzcm1*sin(q1-q1L)+m1*L2*ellycm1*...
         cos(q2-q1L)+m3*L2*L1*sin(q2-q1L)+m4*L2*ellzcm4*sin(q2-q1L)+m1*L2*...
         ellzcm1*sin(q2-q1L)+m3*L4*L1*sin(q1-q1L)+m4*L4*ellycm4*...
         cos(q1-q1L)+m4*L4*ellzcm4*sin(q1-q1L)+m4*L2*ellycm4*cos(q2-q1L))*...
         dqT+(m3*L4*L1*sin(q1-q1L)+m1*L4*ellzcm1*sin(q1-q1L)+m4*L4*...
         ellzcm4*sin(q1-q1L)+m4*L4*ellycm4*cos(q1-q1L)+m1*L4*ellycm1*...
         cos(q1-q1L))*dq1+(m4*L2*ellycm4*cos(q2-q1L)+m1*L2*ellycm1*...
         cos(q2-q1L)+m3*L2*L1*sin(q2-q1L)+m4*L2*ellzcm4*sin(q2-q1L)+m1*L2*...
         ellzcm1*sin(q2-q1L))*dq2+(m3*L1*ellycm3*cos(q1L-q2L)+m3*L1*...
         ellzcm3*sin(q1L-q2L)+m4*L2*ellzcm4*sin(q1L-q2L)-m4*L2*ellycm4*...
         cos(q1L-q2L))*dq2L;
C(6,2)=L4*(m3*L1*sin(q1-q1L)+m1*ellzcm1*sin(q1-q1L)+m4*ellzcm4*...
         sin(q1-q1L)+m4*ellycm4*cos(q1-q1L)+m1*ellycm1*cos(q1-q1L))*...
         (dqT+dq1);
C(6,3)=L2*(m4*ellycm4*cos(q2-q1L)+m1*ellycm1*cos(q2-q1L)+m3*L1*...
         sin(q2-q1L)+m4*ellzcm4*sin(q2-q1L)+m1*ellzcm1*sin(q2-q1L))*...
         (dqT+dq2);
C(6,7)=(m3*L1*ellycm3*cos(q1L-q2L)+m3*L1*ellzcm3*sin(q1L-q2L)+m4*...
         L2*ellzcm4*sin(q1L-q2L)-m4*L2*ellycm4*cos(q1L-q2L))*(dqT+dq2L);
C(7,1)=(m4*L2^2*sin(q2-q2L)+m3*L2*ellycm3*cos(q2-q2L)+m4*L4*L2*...
         sin(q1-q2L)+m3*L4*ellzcm3*sin(q1-q2L)+m3*L4*ellycm3*...
         cos(q1-q2L)+m2*L4*ellycm2*cos(q1-q2L)-m3*L1*ellycm3*...
         cos(q1L-q2L)+m4*L2*ellycm4*cos(q1L-q2L)-m4*L2*ellzcm4*...
         sin(q1L-q2L)-m3*L1*ellzcm3*sin(q1L-q2L)+m2*L2*ellzcm2*...
         sin(q2-q2L)+m2*L2*ellycm2*cos(q2-q2L)+m3*L2*ellzcm3*...
         sin(q2-q2L)+m2*L4*ellzcm2*sin(q1-q2L))*dqT+(m2*L4*ellzcm2*...
         sin(q1-q2L)+m2*L4*ellycm2*cos(q1-q2L)+m3*L4*ellycm3*...
         cos(q1-q2L)+m3*L4*ellzcm3*sin(q1-q2L)+m4*L4*L2*sin(q1-q2L))*...
         dq1+(m2*L2*ellycm2*cos(q2-q2L)+m2*L2*ellzcm2*sin(q2-q2L)+m3*L2*...
         ellzcm3*sin(q2-q2L)+m3*L2*ellycm3*cos(q2-q2L)+m4*L2^2*...
         sin(q2-q2L))*dq2+(-m3*L1*ellycm3*cos(q1L-q2L)-m3*L1*ellzcm3*...
         sin(q1L-q2L)-m4*L2*ellzcm4*sin(q1L-q2L)+m4*L2*ellycm4*...
         cos(q1L-q2L))*dq1L;
C(7,2)=L4*(m2*ellzcm2*sin(q1-q2L)+m2*ellycm2*cos(q1-q2L)+m3*...
         ellycm3*cos(q1-q2L)+m3*ellzcm3*sin(q1-q2L)+m4*L2*sin(q1-q2L))*...
         (dqT+dq1);
C(7,3)=L2*(m2*ellycm2*cos(q2-q2L)+m2*ellzcm2*sin(q2-q2L)+m3*...
         ellzcm3*sin(q2-q2L)+m3*ellycm3*cos(q2-q2L)+m4*L2*sin(q2-q2L))*...
         (dqT+dq2);
C(7,6)=-(m3*L1*ellycm3*cos(q1L-q2L)+m3*L1*ellzcm3*...
         sin(q1L-q2L)+m4*L2*ellzcm4*sin(q1L-q2L)-m4*L2*ellycm4*...
         cos(q1L-q2L))*(dqT+dq1L);
%%%%
%%%%
%%%%
%%%%
G=zeros(9,1);
G(1)=g*(m4*cos(qT+q1)*ellycm4-m2*sin(qT+q2L)*ellzcm2+m2*...
         cos(qT+q2L)*ellycm2-m4*sin(qT+q1)*ellzcm4-m3*sin(qT+q1L)*L1+mT*...
         sin(qT+q1)*L4-mT*sin(qT)*ellzcmT+m1*cos(qT+q1)*ellycm1+mH*...
         sin(qT+q1)*L4+mT*sin(qT+q2)*L2-m1*sin(qT+q1L)*ellzcm1+mH*...
         sin(qT+q2)*L2+m1*cos(qT+q1L)*ellycm1+m3*cos(qT+q2)*ellycm3-m3*...
         sin(qT+q1)*L1-m1*sin(qT+q1)*ellzcm1+m4*cos(qT+q1L)*ellycm4-m4*...
         sin(qT+q1L)*ellzcm4-m3*sin(qT+q2L)*ellzcm3+2*m1*sin(qT+q1)*L4+2*...
         m1*sin(qT+q2)*L2+2*m4*sin(qT+q1)*L4+2*m3*sin(qT+q1)*L4+2*m2*...
         sin(qT+q2)*L2+2*m3*sin(qT+q2)*L2+2*m2*sin(qT+q1)*L4+mT*cos(qT)*...
         ellycmT-m3*sin(qT+q2)*ellzcm3+m2*cos(qT+q2)*ellycm2+m3*...
         cos(qT+q2L)*ellycm3-m4*sin(qT+q2L)*L2+m4*sin(qT+q2)*L2-m2*...
         sin(qT+q2)*ellzcm2);
G(2)=g*(m4*cos(qT+q1)*ellycm4-m4*sin(qT+q1)*ellzcm4-m3*...
         sin(qT+q1)*L1-m1*sin(qT+q1)*ellzcm1+2*m1*sin(qT+q1)*L4+2*m4*...
         sin(qT+q1)*L4+2*m3*sin(qT+q1)*L4+2*m2*sin(qT+q1)*L4+mT*...
         sin(qT+q1)*L4+m1*cos(qT+q1)*ellycm1+mH*sin(qT+q1)*L4)+K1*...
         (q1-qgr1);
G(3)=g*(-m3*sin(qT+q2)*ellzcm3+m2*cos(qT+q2)*ellycm2+m4*...
         sin(qT+q2)*L2-m2*sin(qT+q2)*ellzcm2+2*m1*sin(qT+q2)*L2+2*m2*...
         sin(qT+q2)*L2+2*m3*sin(qT+q2)*L2+mT*sin(qT+q2)*L2+mH*sin(qT+q2)*...
         L2+m3*cos(qT+q2)*ellycm3)+K2*(q2-qgr2);
G(4)=-K1*(q1-qgr1);
G(5)=-K2*(q2-qgr2);
G(6)=g*(-m3*sin(qT+q1L)*L1+m4*cos(qT+q1L)*ellycm4-m4*sin(qT+q1L)*...
         ellzcm4-m1*sin(qT+q1L)*ellzcm1+m1*cos(qT+q1L)*ellycm1)+K1*...
         (q1L-qgr1L);
G(7)=g*(-m2*sin(qT+q2L)*ellzcm2+m2*cos(qT+q2L)*ellycm2+m3*...
         cos(qT+q2L)*ellycm3-m4*sin(qT+q2L)*L2-m3*sin(qT+q2L)*ellzcm3)+K2*...
         (q2L-qgr2L);
G(8)=-K1*(q1L-qgr1L);
G(9)=-K2*(q2L-qgr2L);
%%%%
%%%%
%%%%
%%%%
B=zeros(9,4);
B(4,1)=R1;
B(5,2)=R2;
B(8,3)=R1;
B(9,4)=R2;
%%%%
%%%%
%%%%
%%%%
B_HarmonicDrive=zeros(9,4);
B_HarmonicDrive(4,1)=1;
B_HarmonicDrive(5,2)=1;
B_HarmonicDrive(8,3)=1;
B_HarmonicDrive(9,4)=1;
%%%%
%%%%
DampingSpringTorque=zeros(9,1);
DampingSpringTorque(1)=0;
DampingSpringTorque(2)=-Kd1*(-dq1+dqgr1);
DampingSpringTorque(3)=-Kd2*(-dq2+dqgr2);
DampingSpringTorque(4)=Kd1*(-dq1+dqgr1);
DampingSpringTorque(5)=Kd2*(-dq2+dqgr2);
DampingSpringTorque(6)=-Kd1*(-dq1L+dqgr1L);
DampingSpringTorque(7)=-Kd2*(-dq2L+dqgr2L);
DampingSpringTorque(8)=Kd1*(-dq1L+dqgr1L);
DampingSpringTorque(9)=Kd2*(-dq2L+dqgr2L);
return